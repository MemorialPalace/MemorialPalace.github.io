<!doctype html>
<html lang="ko" data-style="professional" data-density="comfortable" data-radius="md">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Memory Palace — Landing</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- 한국어 가독성 좋은 폰트 -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Design tokens (Minimal + Professional 기본값) -->
  <style>
    :root{
      --bg:#0b1020;            /* 다크 네이비 */
      --surface:#0f172a;       /* 카드 배경 */
      --text:#e5e7eb;          /* 본문 글자 */
      --muted:#93a5c5;         /* 보조 텍스트 */
      --line:rgba(255,255,255,.08);
      --brand:#60a5fa;         /* 포인트 블루 */
      --ring:rgba(96,165,250,.35);
      --radius:16px;
      --radius-sm:12px; --radius-lg:24px;
      --pad-comfort:1.25rem;   /* 카드 내부 여백 */
      --pad-compact:.8rem;
    }
    html[data-style="minimal"]{
      --bg:#ffffff; --surface:#ffffff; --text:#111111; --muted:#6b7280; --line:rgba(0,0,0,.08); --brand:#111827;
    }
    html[data-style="professional"]{ /* 위 기본값 유지 (네이비/다크블루) */ }
    html[data-style="modern"]{
      --bg:#f8fafc; --surface:#ffffff; --text:#0b0b0c; --muted:#64748b; --line:rgba(0,0,0,.06); --brand:#6366f1;
    }
    html[data-style="tailwind"]{
      --bg:#f8fafc; --surface:#ffffff; --text:#0b0b0c; --muted:#6b7280; --line:rgba(0,0,0,.08); --brand:#3b82f6;
    }
    html[data-style="playful"]{
      --bg:#fff7ed; --surface:#ffffff; --text:#0b0b0c; --muted:#64748b; --line:rgba(0,0,0,.06); --brand:#22c55e;
    }
    html[data-style="portfolio"]{
      --bg:#ffffff; --surface:#f9fafb; --text:#0b0b0c; --muted:#6b7280; --line:rgba(0,0,0,.08); --brand:#111827;
    }
    html[data-style="landing"]{
      --bg:#fafafa; --surface:#ffffff; --text:#0b0b0c; --muted:#6b7280; --line:rgba(0,0,0,.08); --brand:#7c3aed;
    }

    body{ background:var(--bg); color:var(--text); font-family:"Noto Sans KR", system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", "Malgun Gothic", Arial, sans-serif; }
    .card{
      background:var(--surface);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow: 0 1px 0 rgba(255,255,255,.04) inset, 0 12px 28px rgba(0,0,0,.18);
    }
    .btn{
      border-radius:9999px; padding:.7rem 1rem; font-weight:600; transition:all .15s ease;
      border:1px solid var(--line);
    }
    .btn-primary{ background:var(--brand); color:#fff; border-color:transparent; }
    .btn-primary:hover{ filter:brightness(1.05); }
    .btn-ghost{ background:transparent; color:var(--text); }
    .btn-ghost:hover{ background:rgba(255,255,255,.06); }
    .chip{ background:rgba(255,255,255,.08); color:var(--text); border-radius:9999px; padding:.25rem .6rem; font-size:.75rem; }
    .muted{ color:var(--muted); }

    /* 밀도/모서리 사용자 토글 */
    html[data-density="comfortable"] .pad { padding: var(--pad-comfort); }
    html[data-density="compact"] .pad { padding: var(--pad-compact); }
    html[data-radius="sm"] .card, html[data-radius="sm"] .btn { border-radius: var(--radius-sm); }
    html[data-radius="md"] .card, html[data-radius="md"] .btn { border-radius: var(--radius); }
    html[data-radius="lg"] .card, html[data-radius="lg"] .btn { border-radius: var(--radius-lg); }

    a{ color:var(--text); }
    a:hover{ opacity:.9; }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- ===== NAV ===== -->
  <header class="w-full border-b" style="border-color:var(--line)">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="images/logo.png" alt="logo" class="w-8 h-8 rounded-md object-cover" />
        <span class="text-lg">Memory Palace</span>
        <span class="chip hidden sm:inline">Professional · Minimal</span>
      </div>
      <div class="flex items-center gap-2">
        <select id="styleSelect" class="bg-[var(--surface)] text-[var(--text)] border rounded-md px-3 py-2 text-sm"
                style="border-color:var(--line)">
          <option value="professional" selected>Professional</option>
          <option value="minimal">Minimal</option>
          <option value="modern">Modern</option>
          <option value="tailwind">Tailwind</option>
          <option value="portfolio">Portfolio</option>
          <option value="landing">Landing</option>
          <option value="playful">Playful</option>
        </select>

        <select id="densitySelect" class="bg-[var(--surface)] text-[var(--text)] border rounded-md px-3 py-2 text-sm"
                style="border-color:var(--line)">
          <option value="comfortable" selected>여백: 넉넉</option>
          <option value="compact">여백: 촘촘</option>
        </select>

        <select id="radiusSelect" class="bg-[var(--surface)] text-[var(--text)] border rounded-md px-3 py-2 text-sm"
                style="border-color:var(--line)">
          <option value="md" selected>모서리: 보통</option>
          <option value="sm">모서리: 각짐</option>
          <option value="lg">모서리: 둥글게</option>
        </select>

        <a href="#cta" class="btn btn-primary text-sm">시작하기</a>
      </div>
    </div>
  </header>

  <!-- ===== HERO ===== -->
  <section class="w-full">
    <div class="max-w-7xl mx-auto px-4 pt-10 pb-12 grid md:grid-cols-2 gap-8 items-center">
      <div>
        <h1 class="text-3xl md:text-4xl font-semibold leading-tight">
          기억의 궁전으로 구조를 설계하고,<br class="hidden md:block" /> 흐름을 차분하게 시각화합니다.
        </h1>
        <p class="mt-4 muted leading-relaxed">
          이 템플릿은 <span class="underline underline-offset-2">이력서</span>·<span class="underline underline-offset-2">스타트업 랜딩</span>·<span class="underline underline-offset-2">상품 판매</span> 페이지로 바로 전용할 수 있는
          <span class="whitespace-nowrap">모던·반응형</span> 단일 파일입니다. 아래의 프롬프트 섹션에서<br />
          <code class="px-1 rounded bg-white/10">4-17 길음 – 보험관리자 – 고전 – 삼국지17</code> 처럼 입력하면 카드로 정리됩니다.
        </p>
        <div class="mt-6 flex flex-wrap gap-3">
          <a href="#prompt" class="btn btn-primary">프롬프트로 만들기</a>
          <a href="#features" class="btn btn-ghost">기능 보기</a>
        </div>
        <div class="mt-4 flex gap-2">
          <span class="chip">여백 중심</span>
          <span class="chip">정갈한 타이포</span>
          <span class="chip">한국어 UI</span>
        </div>
      </div>
      <div class="relative">
        <!-- Hero 이미지 (원하는 경우 교체) -->
        <img src="images/스크린샷%202024-06-19%20100147.png" alt="hero" class="w-full h-72 md:h-96 object-cover card" />
      </div>
    </div>
  </section>

  <!-- ===== WRITING (요청하신 글 반영) ===== -->
  <section id="writing" class="w-full">
    <div class="max-w-7xl mx-auto px-4 py-10">
      <h2 class="text-2xl md:text-3xl font-semibold">Featured Writing</h2>
      <p class="mt-2 muted">김진균 교수 관련 글과 예수회 관련 글 요약을 카드·섹션 양쪽에 반영했습니다.</p>

      <!-- 두 편의 대표 글 -->
      <div class="mt-6 grid sm:grid-cols-2 gap-6">
        <!-- 김진균 교수 -->
        <article id="kim" class="card pad">
          <div class="text-xl font-medium">김진균 교수 수집록 분석 요약</div>
          <p class="mt-2 text-sm muted leading-relaxed">
            서울대 기록원에서의 정리 참여 경험을 바탕으로, 민주화운동의 현장성과 사회학적 사상을 연결했습니다.
            핵심은 <strong>기록의 맥락 보존</strong>, <strong>인적 네트워크 추적</strong>, <strong>수집·정리의 반복성</strong>입니다.
            대량 자료를 주제·인물·시대 축으로 교차 분류하여 <em>검색성</em>을 높였고, 연구자·활동가가 재활용하기 쉬운 메타데이터 체계를 제안했습니다.
          </p>
          <ul class="mt-3 text-sm list-disc pl-5 muted">
            <li>민주화 관련 인물·단체 간 <em>관계 그래프</em> 초안 도출</li>
            <li>메타데이터: 생산주체/시기/장소/매체/권리/키워드</li>
            <li>활용 시나리오: 전시 동선/연구 주제별 패킷/교육 커리큘럼</li>
          </ul>
          <a href="#prompt" class="mt-4 inline-block btn btn-ghost text-sm">카드로 보내기</a>
        </article>
        <!-- 예수회 -->
        <article id="jesuit" class="card pad">
          <div class="text-xl font-medium">예수회 청년 사도직: 순명과 소통의 균형</div>
          <p class="mt-2 text-sm muted leading-relaxed">
            순명 문화가 청년 세대의 <strong>자율적 참여</strong>와 <strong>투명한 의사결정</strong>을 저해할 수 있다는 지점을 짚고,
            <em>실용적 봉사 설계</em>(시간·역할·보상·학습 피드백)의 표준화가 신뢰를 복원한다고 제안합니다.
            본당 중심의 일방향 동원 대신, 관심 기반 소그룹(마지스, 포콜라레 등)과의 연계 모델을 설계했습니다.
          </p>
          <ul class="mt-3 text-sm list-disc pl-5 muted">
            <li>참여 설계: 역할명세서·온보딩·성찰 리포트·VMS 연계</li>
            <li>소통 규범: 갈등 로깅·중재 프로토콜·오픈 피드백</li>
            <li>성과: 측정 가능한 봉사 KPI와 서사(스토리) 동시 기록</li>
          </ul>
          <a href="#prompt" class="mt-4 inline-block btn btn-ghost text-sm">카드로 보내기</a>
        </article>
      </div>
    </div>
  </section>

  <!-- ===== FEATURES ===== -->
  <section id="features" class="w-full">
    <div class="max-w-7xl mx-auto px-4 py-10">
      <h2 class="text-2xl md:text-3xl font-semibold">핵심 기능 3가지</h2>
      <p class="mt-2 muted">상단 소개, 기능 카드, CTA, 푸터 — 랜딩 페이지 기본 구조.</p>
      <div class="mt-6 grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="card pad">
          <img src="images/feature-1.png" alt="feature 1" class="w-10 h-10 mb-3 opacity-90" />
          <div class="font-medium">프롬프트 → 카드</div>
          <p class="mt-1 text-sm muted">노선·숫자·스토리 한 줄 입력으로 카드화.</p>
        </div>
        <div class="card pad">
          <img src="images/feature-2.png" alt="feature 2" class="w-10 h-10 mb-3 opacity-90" />
          <div class="font-medium">검색/필터</div>
          <p class="mt-1 text-sm muted">라인, 키워드로 빠르게 찾고 그리드로 둘러보기.</p>
        </div>
        <div class="card pad">
          <img src="images/feature-3.png" alt="feature 3" class="w-10 h-10 mb-3 opacity-90" />
          <div class="font-medium">JSON 백업</div>
          <p class="mt-1 text-sm muted">images 폴더만 올리면 시각 요소도 유지하기 쉬움.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== PROMPT ===== -->
  <section id="prompt" class="w-full">
    <div class="max-w-7xl mx-auto px-4 py-10 grid lg:grid-cols-2 gap-6 items-start">
      <div class="card pad">
        <div class="text-xl font-semibold">기억의 궁전 프롬프트</div>
        <p class="mt-2 text-sm muted">예) 4-17 길음 – 보험관리자 – 고전 – 삼국지17</p>
        <div class="mt-4 flex gap-2">
          <input id="promptInput" class="flex-1 border rounded-md px-3 py-2 bg-transparent"
                 style="border-color:var(--line); color:var(--text)" placeholder="4-17 길음 – 보험관리자 – 고전 – 삼국지17" />
          <button id="parseBtn" class="btn btn-primary">추가</button>
        </div>

        <div class="mt-4 grid sm:grid-cols-2 gap-3">
          <input id="line" class="border rounded-md px-3 py-2 bg-transparent"
                 style="border-color:var(--line); color:var(--text)" placeholder="노선 (예: 4호선)" />
          <input id="index" class="border rounded-md px-3 py-2 bg-transparent"
                 style="border-color:var(--line); color:var(--text)" placeholder="인덱스 (예: 417)" />
          <input id="station" class="border rounded-md px-3 py-2 bg-transparent"
                 style="border-color:var(--line); color:var(--text)" placeholder="장소/역 (예: 길음)" />
          <input id="title" class="border rounded-md px-3 py-2 bg-transparent"
                 style="border-color:var(--line); color:var(--text)" placeholder="짧은 제목" />
          <input id="media" class="border rounded-md px-3 py-2 bg-transparent"
                 style="border-color:var(--line); color:var(--text)" placeholder="작품/매체 (예: 삼국지 17권)" />
          <input id="tags" class="border rounded-md px-3 py-2 bg-transparent"
                 style="border-color:var(--line); color:var(--text)" placeholder="태그(쉼표)" />
        </div>
        <textarea id="story" rows="3" class="mt-3 w-full border rounded-md px-3 py-2 bg-transparent"
                  style="border-color:var(--line); color:var(--text)" placeholder="스토리/연상 (예: 보험관리자 고전 장면)"></textarea>

        <div class="mt-3 flex flex-wrap gap-2">
          <button id="addBtn" class="btn btn-ghost">수동 추가</button>
          <button id="clearBtn" class="btn btn-ghost">폼 초기화</button>
          <button id="exportBtn" class="btn btn-ghost">JSON 내보내기</button>
          <label class="btn btn-ghost cursor-pointer">JSON 불러오기
            <input id="importFile" type="file" accept="application/json" class="hidden" />
          </label>
        </div>
      </div>

      <div>
        <div class="flex items-center justify-between mb-3">
          <div class="text-lg font-medium">카드 목록</div>
          <input id="search" placeholder="검색…" class="border rounded-md px-3 py-2 bg-transparent text-sm"
                 style="border-color:var(--line); color:var(--text)" />
        </div>
        <div id="grid" class="grid sm:grid-cols-2 xl:grid-cols-3 gap-4"></div>
      </div>
    </div>
  </section>

  <!-- ===== GALLERY ===== -->
  <section class="w-full">
    <div class="max-w-7xl mx-auto px-4 pb-10">
      <h2 class="text-2xl md:text-3xl font-semibold">샘플 갤러리</h2>
      <p class="mt-2 muted">images 폴더에 이미지를 넣으면 자동 표시됩니다.</p>
      <div class="mt-6 grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <img src="images/스크린샷%202024-06-19%20100147.png" alt="grid-ss" class="card w-full h-48 object-cover" />
        <img src="images/grid-1.jpg" alt="grid-1" class="card w-full h-48 object-cover" />
        <img src="images/grid-2.jpg" alt="grid-2" class="card w-full h-48 object-cover" />
      </div>
    </div>
  </section>

  <!-- ===== CTA ===== -->
  <section id="cta" class="w-full">
    <div class="max-w-7xl mx-auto px-4 pb-16">
      <div class="card pad flex flex-col md:flex-row items-center justify-between gap-4">
        <div>
          <div class="text-xl md:text-2xl font-semibold">나만의 ‘기억의 궁전’ 랜딩을 시작합니다.</div>
          <p class="text-sm muted mt-1">이미지 폴더만 올리면 바로 완성됩니다.</p>
        </div>
        <a href="#prompt" class="btn btn-primary">지금 만들기</a>
      </div>
    </div>
  </section>

  <!-- ===== FOOTER ===== -->
  <footer class="mt-auto w-full border-t" style="border-color:var(--line)">
    <div class="max-w-7xl mx-auto px-4 py-8 text-sm muted flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-between">
      <div>© <span id="year"></span> Memory Palace. All rights reserved.</div>
      <div class="flex items-center gap-2">
        <a class="chip" href="#writing">글</a>
        <a class="chip" href="#features">기능</a>
        <a class="chip" href="#prompt">프롬프트</a>
        <a class="chip" href="#cta">시작하기</a>
      </div>
    </div>
  </footer>

  <!-- ===== SCRIPT ===== -->
  <script>
    (function(){
      function $(sel, parent){ return (parent||document).querySelector(sel); }
      var grid = $("#grid");

      var stateKey = 'mp_cards_v1';
      var styleKey = 'mp_style';
      var densityKey = 'mp_density';
      var radiusKey = 'mp_radius';

      var inputs = {
        prompt: $("#promptInput"),
        line: $("#line"),
        index: $("#index"),
        station: $("#station"),
        title: $("#title"),
        story: $("#story"),
        media: $("#media"),
        tags: $("#tags"),
        search: $("#search"),
        importFile: $("#importFile")
      };

      // 스타일/밀도/모서리 토글 (로컬 저장)
      var styleSelect = $("#styleSelect");
      var densitySelect = $("#densitySelect");
      var radiusSelect = $("#radiusSelect");

      function setAttr(key, value, storageKey){
        document.documentElement.setAttribute(key, value);
        try { localStorage.setItem(storageKey, value); } catch (e) {}
      }
      (function initPrefs(){
        var s = (function(){ try { return localStorage.getItem(styleKey) || 'professional'; } catch(e){ return 'professional'; }})();
        var d = (function(){ try { return localStorage.getItem(densityKey) || 'comfortable'; } catch(e){ return 'comfortable'; }})();
        var r = (function(){ try { return localStorage.getItem(radiusKey) || 'md'; } catch(e){ return 'md'; }})();
        if (styleSelect) styleSelect.value = s;
        if (densitySelect) densitySelect.value = d;
        if (radiusSelect) radiusSelect.value = r;
        setAttr('data-style', s, styleKey);
        setAttr('data-density', d, densityKey);
        setAttr('data-radius', r, radiusKey);
      })();
      if (styleSelect) styleSelect.addEventListener('change', function(e){ setAttr('data-style', e.target.value, styleKey); });
      if (densitySelect) densitySelect.addEventListener('change', function(e){ setAttr('data-density', e.target.value, densityKey); });
      if (radiusSelect) radiusSelect.addEventListener('change', function(e){ setAttr('data-radius', e.target.value, radiusKey); });

      // 안전한 localStorage 래퍼
      function load(){
        try { var raw = localStorage.getItem(stateKey) || '[]'; return JSON.parse(raw); } catch(e){ return []; }
      }
      function save(list){ try { localStorage.setItem(stateKey, JSON.stringify(list)); } catch(e){} }

      var cards = load();

      function uid(){
        try{ if (window.crypto && window.crypto.randomUUID) return window.crypto.randomUUID(); }catch(e){}
        return 'id-' + Date.now() + '-' + Math.random().toString(36).slice(2);
      }

      // 정렬
      function cmpIndex(a, b){
        var ai = (a.index||'');
        var bi = (b.index||'');
        return ai.localeCompare(bi, undefined, { numeric: true, sensitivity: 'base' });
      }

      function escapeHtml(str){
        return String(str)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      }

      // 렌더
      function render(list){
        list = list || cards;
        if (!grid) return;
        grid.innerHTML = '';
        var q = (inputs.search && inputs.search.value ? String(inputs.search.value) : '').toLowerCase();
        var filtered = list.filter(function(c){
          if(!q) return true;
          var hay = [c.line,c.index,c.station,c.title,c.story,c.media].concat(c.tags||[]).join(' ').toLowerCase();
          return hay.indexOf(q) !== -1;
        }).sort(cmpIndex);

        for (var i=0;i<filtered.length;i++){
          var c = filtered[i];
          var el = document.createElement('div');
          el.className = 'card pad flex flex-col gap-2';

          var tagsHtml = '';
          if (c.tags && c.tags.length){
            for (var t=0;t<c.tags.length;t++){
              var tag = c.tags[t];
              tagsHtml += '<span class="chip">#'+ escapeHtml(String(tag)) +'</span>';
            }
          }
          var mediaHtml = c.media ? '<span>📚 '+ escapeHtml(String(c.media)) +'</span>' : '';
          var stationHtml = c.station ? '<span class="ml-2 text-sm muted">'+ escapeHtml(String(c.station)) +'</span>' : '';
          var titleHtml = c.title ? '<div class="font-medium">'+ escapeHtml(String(c.title)) +'</div>' : '';
          var storyHtml = c.story ? '<div class="text-sm muted leading-relaxed">'+ escapeHtml(String(c.story)) +'</div>' : '';

          el.innerHTML = ''+
            '<div class="flex items-center justify-between">'+
              '<div>'+
                '<span class="chip mr-2">'+ escapeHtml(String(c.line||'')) +'</span>'+
                '<span class="font-mono">'+ escapeHtml(String(c.index||'')) +'</span>'+
                stationHtml+
              '</div>'+
              '<button class="text-sm chip" data-del="'+ escapeHtml(String(c.id||'')) +'">삭제</button>'+
            '</div>'+
            titleHtml+
            storyHtml+
            '<div class="flex flex-wrap items-center gap-2 text-xs muted">'+
              mediaHtml +
              tagsHtml+
            '</div>';

          grid.appendChild(el);
        }
      }

      // 초기 샘플 없으면 주입 + 요청 글 2건 항상 보장
      var ensured = false;
      if (!cards || !cards.length){ cards = []; ensured = true; }

      function pushOnce(idx, entry){
        var exists = cards.some(function(c){ return c.index === idx; });
        if (!exists){ cards.push(entry); }
      }

      // 김진균 교수 글 카드
      pushOnce('KJ-001', {
        id: uid(), line:'연구', index:'KJ-001', station:'서울대 기록원',
        title:'김진균 교수 수집록 분석 요약',
        story:'민주화운동·사회사 자료를 맥락 보존/인적 네트워크/메타데이터 체계로 정리하여 연구·전시·교육 재활용성을 높임.',
        media:'분석 보고서(요약본)', tags:['김진균','기록학','민주화'], createdAt: Date.now()
      });

      // 예수회 글 카드
      pushOnce('SJ-001', {
        id: uid(), line:'에세이', index:'SJ-001', station:'예수회',
        title:'순명과 소통: 청년 사도직 제언',
        story:'순명 중심 문화의 리스크를 줄이고 참여 설계·소통 규범·성과 지표를 표준화하여 신뢰를 복원하는 프레임 제안.',
        media:'에세이(공개용)', tags:['예수회','청년사도직','소통'], createdAt: Date.now()
      });

      // 기존 데모 카드 유지(처음 한 번만)
      if (ensured){
        cards.push(
          { id: uid(), line:'4호선', index:'417', station:'길음', title:'보험관리자의 고전',
            story:'길음역 앞에서 보험 관리자 분이 고전(苦戰)하는 장면으로 4-17을 기억.',
            media:'전략 삼국지 17권(관우의 고전)', tags:['삼국지','4호선'], createdAt: Date.now() },
          { id: uid(), line:'5호선', index:'517', station:'화곡', title:'예수회 신학원 × 프랑스 은화',
            story:'화곡(예수회 신학원) + 김전일 프랑스 은화 살인사건 결합',
            media:'김전일 사건파일', tags:['김전일','5호선'], createdAt: Date.now() }
        );
      }

      save(cards); render(cards);

      if (grid) {
        grid.addEventListener('click', function(e){
          var tgt = e.target || e.srcElement;
          var id = (tgt && tgt.getAttribute) ? tgt.getAttribute('data-del') : null;
          if(!id) return;
          if(!window.confirm('삭제할까요?')) return;
          var next = [];
          for (var i=0;i<cards.length;i++){
            if (cards[i].id !== id) next.push(cards[i]);
          }
          cards = next; save(cards); render();
        });
      }

      if (inputs && inputs.search){ inputs.search.addEventListener('input', function(){ render(); }); }

      // 프롬프트 파서
      function parsePrompt(raw){
        if(!raw) return {};
        var norm = String(raw)
          .replace(/[—–|:·]/g,'-')
          .replace(/\s+/g,' ')
          .trim();
        var firstSpace = norm.indexOf(' ');
        var head = firstSpace > 0 ? norm.slice(0, firstSpace) : norm;
        var tail = firstSpace > 0 ? norm.slice(firstSpace+1) : '';

        var line='';
        var index='';
        var m = head.match(/^(\d+)[\-\/]?\s*(?:호선)?\s*(\d+)?$/);
        if(m){
          if(m[2]){ line = m[1] + '호선'; index = m[1] + m[2]; }
          else if(m[1].length>=2){ var d=m[1]; line = d.charAt(0) + '호선'; index = d; }
        }
        var parts = tail.split('-');
        var cleaned = [];
        for (var i=0;i<parts.length;i++){ var s = parts[i].trim(); if (s) cleaned.push(s); }
        var station = cleaned[0] || '';
        var title = cleaned[1] || '';
        var story = cleaned[2] || '';
        var media = cleaned[3] || '';
        return { line: line, index: index, station: station, title: title, story: story, media: media };
      }

      function fillForm(r){
        if(!r) return;
        if (inputs.line && r.line) inputs.line.value = r.line;
        if (inputs.index && r.index) inputs.index.value = r.index;
        if (inputs.station && r.station) inputs.station.value = r.station;
        if (inputs.title && r.title) inputs.title.value = r.title;
        if (inputs.story && r.story) inputs.story.value = r.story;
        if (inputs.media && r.media) inputs.media.value = r.media;
      }

      var parseBtn = $("#parseBtn");
      if (parseBtn) {
        parseBtn.addEventListener('click', function(){
          var r = parsePrompt(inputs.prompt ? inputs.prompt.value : '');
          var hasAny = false;
          for (var k in r){ if (r.hasOwnProperty(k) && r[k]) { hasAny = true; break; } }
          if(!hasAny){ window.alert('파싱 실패. 예) 4-17 길음 – 보험관리자 – 고전 – 삼국지17'); return; }
          fillForm(r);
        });
      }

      var addBtn = $("#addBtn");
      if (addBtn) {
        addBtn.addEventListener('click', function(){
          var line = inputs.line ? String(inputs.line.value||'').trim() : '';
          var index = inputs.index ? String(inputs.index.value||'').trim() : '';
          if(!line || !index){ window.alert('노선과 인덱스는 필수입니다.'); return; }
          var station = inputs.station ? String(inputs.station.value||'').trim() : '';
          var title = inputs.title ? String(inputs.title.value||'').trim() : '';
          var story = inputs.story ? String(inputs.story.value||'').trim() : '';
          var media = inputs.media ? String(inputs.media.value||'').trim() : '';
          var tagsRaw = inputs.tags ? String(inputs.tags.value||'') : '';
          var tags = [];
          if (tagsRaw){
            var sp = tagsRaw.split(',');
            for (var i=0;i<sp.length;i++){ var s = sp[i].trim(); if (s) tags.push(s); }
          }
          var item = { id: uid(), line: line, index: index, station: station, title: title, story: story, media: media, tags: tags, createdAt: Date.now() };
          cards.push(item); save(cards); render();
          var keys = ['prompt','line','index','station','title','story','media','tags'];
          for (var j=0;j<keys.length;j++){ var key = keys[j]; if (inputs[key]) inputs[key].value=''; }
        });
      }

      var clearBtn = $("#clearBtn");
      if (clearBtn) {
        clearBtn.addEventListener('click', function(){
          var keys = ['prompt','line','index','station','title','story','media','tags'];
          for (var j=0;j<keys.length;j++){ var key = keys[j]; if (inputs[key]) inputs[key].value=''; }
        });
      }

      var exportBtn = $("#exportBtn");
      if (exportBtn) {
        exportBtn.addEventListener('click', function(){
          try{
            var blob = new Blob([JSON.stringify(cards, null, 2)], {type:'application/json;charset=utf-8'});
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url; a.download = 'memory-palace.json';
            document.body.appendChild(a); a.click();
            setTimeout(function(){ URL.revokeObjectURL(url); if (a && a.parentNode) a.parentNode.removeChild(a); }, 0);
          }catch(e){ console.error(e); }
        });
      }

      if (inputs.importFile) {
        inputs.importFile.addEventListener('change', function(ev){
          var file = ev && ev.target && ev.target.files ? ev.target.files[0] : null; if(!file) return;
          var reader = new FileReader();
          reader.onload = function(){
            try{
              var text = String(reader.result || '[]');
              var obj = JSON.parse(text);
              if(Object.prototype.toString.call(obj) !== '[object Array]') throw new Error('형식 오류');
              var next = [];
              for (var i=0;i<obj.length;i++){
                var o = obj[i] || {};
                next.push({ id: o.id || uid(), line: o.line || '', index: o.index || '', station: o.station || '', title: o.title || '', story: o.story || '', media: o.media || '', tags: o.tags || [], createdAt: o.createdAt || Date.now() });
              }
              cards = next; save(cards); render();
            }catch(err){ window.alert('JSON을 읽을 수 없습니다.'); }
          };
          reader.readAsText(file);
        });
      }

      var yearEl = $("#year");
      if (yearEl) { yearEl.textContent = String(new Date().getFullYear()); }
    })();
  </script>
</body>
</html>
